#!/usr/bin/env bash

set -eu

me=${0##*/}
usage="Rename files using your preferred editor.

Usage:
    $me [OPTIONS] FILE...

Options:
    -f    use -f instead of -i for generated mv commands
"

usage() {
    printf "%s\n" "$usage"
    exit 0
}

die() {
    printf "ERROR: %s\n" "$*" >&2
    exit 1
}

mkbr_options=()

while getopts ":fh" option; do
    case $option in
    f) mkbr_options+=(-f) ;;
    h) usage ;;
    *) die "Invalid option '$OPTARG'" ;;
    esac
done && shift $((OPTIND - 1))

if (($# == 0)); then
    die "No files to rename"
fi

temp_dir=$(mktemp -d -t "${me}.XXXXXXXXXX")
printf -v cleanup "rm -rf %q" "$temp_dir"
trap "$cleanup" INT TERM EXIT

src_list=$temp_dir/src
dst_list=$temp_dir/dst

printf "%s\n" "$@" | tee "$src_list" "$dst_list"

${EDITOR:-vim} "$dst_list"

mkbr "${mkbr_options[@]}" "$src_list" "$dst_list"

#!/usr/bin/env bash

set -eu

dir=${ASDF_DIR:-$HOME/.asdf}

if [[ -d $dir ]]; then
    cd "$dir"
    git pull origin master
else
    git clone https://github.com/asdf-vm/asdf.git "$dir"
    cd "$dir"
fi

. "$dir"/asdf.sh

if [[ -f ~/.asdf-plugins ]]; then
    while read -r name url; do
        if [[ -d $dir/plugins/$name ]]; then
            asdf plugin update "$name"
        else
            asdf plugin add "$name" "$url"
        fi
        asdf global "$name" system
        asdf install "$name" latest
    done <~/.asdf-plugins
fi

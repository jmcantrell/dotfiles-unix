#!/usr/bin/env bash

# Initialize a Fabric-enabled Mincraft server for the given version.
# Usage: download-minecraft-fabric-server [version]  # default version: latest

set -eu

installer_url=$(curl -sSL https://meta.fabricmc.net/v2/versions/installer | jq -r .[0].url)

if [[ ! -v 1 || $1 == latest ]]; then
    minecraft_version=$(curl -sSL https://launchermeta.mojang.com/mc/game/version_manifest.json | jq -r .latest.release)
else
    minecraft_version=$1
fi

curl -L -o installer.jar "$installer_url"
java -jar installer.jar server -mcversion "$minecraft_version" -downloadMinecraft

rm installer.jar
mv server.jar vanilla.jar
mv fabric-server-launch.jar server.jar
echo "serverJar=vanilla.jar" >fabric-server-launcher.properties
echo "eula=true" >eula.txt

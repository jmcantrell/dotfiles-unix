#!/usr/bin/env bash

# Download the latest Tails ISO, if needed.

set -eu

output_dir=${1:-$HOME/disks}

version=$(curl -Ls https://tails.boum.org/install/v2/Tails/amd64/stable/latest.json | jq -r .installations[0].version)

torrent_uri=https://tails.boum.org/torrents/files/tails-amd64-${version}.iso.torrent

iso_name=$(basename "$torrent_uri" .torrent)
iso_file=$output_dir/$iso_name

if [[ ! -f $iso_file ]]; then
    mkdir -p "$output_dir"
	aria2c-torrent -d "$output_dir" --seed-time 0 "$torrent_uri"
fi

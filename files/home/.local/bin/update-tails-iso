#!/usr/bin/env bash

# Download the latest Tails ISO, if needed.

set -euo pipefail

output_dir=${1:-$HOME/disks}
base_uri=https://tails.boum.org

version=$(
    curl -Ls "$base_uri"/install/v2/Tails/amd64/stable/latest.json |
        jq -r .installations[0].version
)

torrent_uri=$base_uri/torrents/files/tails-amd64-${version}.iso.torrent

iso_name=$(basename "$torrent_uri" .torrent)
iso_file=$output_dir/$iso_name

if [[ ! -f $iso_file ]]; then
    mkdir -p "$output_dir"
    aria2c-torrent -d "$output_dir" --seed-time 0 "$torrent_uri"
fi

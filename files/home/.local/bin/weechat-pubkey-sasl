#!/usr/bin/env bash

# Output the SASL public key for a weechat IRC server.
# Usage: weechat-pubkey-sasl SERVER_NAME

set -euo pipefail

if [[ ! -v 1 ]]; then
    printf "The first argument must be a server name\n" >&2
    exit 1
fi

name=$1
pem=${XDG_CONFIG_HOME:-$HOME/.config}/weechat/$name.pem

openssl ec -noout -text -conv_form compressed -in "$pem" |
    grep '^pub:' -A 3 | tail -n 3 | tr -d ' \n:' | xxd -r -p | base64

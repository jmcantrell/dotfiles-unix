#!/usr/bin/env bash

# Return a sequence of dates.
# Usage: dateseq TIMESTAMP INCREMENT COUNT

# The timestamp parameter can be any string that `date` recognizes, and every
# argument after the count parameter is passed on to `date`, so you can do
# stuff like the following examples:

# Get the dates for the next five hours, starting now:
# dateseq now "+1 hour" 5

# Get the UTC dates in ISO 8601 format for the first three months of 2001:
# dateseq 2001-01-01 "+1 month" 3 --utc --iso-8601

set -eu

timestamp=${1:?Missing initial timestamp}
increment=${2:?Missing increment}
count=${3:?Missing count}
shift 3

normalize_timestamp() {
    date --utc --iso-8601=ns --date="$1"
}

timestamp=$(normalize_timestamp "$timestamp")

for ((i = 0; i < count; i++)); do
    date --date="$timestamp" "$@"
    timestamp=$(normalize_timestamp "$timestamp $increment")
done

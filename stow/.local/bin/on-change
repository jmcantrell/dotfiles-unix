#!/usr/bin/env bash

# Run a command when any file changes in the given directory.
# Usage: on-change [-d DIRECTORY]... COMMAND [ARGUMENT...]

set -eu

directories=()

while getopts "d:" option; do
    case $option in
    d) directories+=("$OPTARG") ;;
    esac
done && shift "$((OPTIND - 1))"

trap 'kill $$' INT

while sleep 0.1; do
    find "${directories[@]:-$PWD}" -type f | entr -acd "$@" || continue
done

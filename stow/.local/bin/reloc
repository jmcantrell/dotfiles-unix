#!/usr/bin/env bash

# Move a bunch of files to a directory,
# then symlink them back to their original location.
# Usage: reloc DIRECTORY [PATH...]

set -euo pipefail

if (($# < 2)); then
    echo "${0##*/}: arguments must be a directory and one or more files" >&2
    exit 1
fi

dst=$1
shift

mkdir -p "$dst"
mv -v -t "$dst" "$@"

for src in "$@"; do
    dir=$(dirname "$src")
    file=$(basename "$src")
    rel=$(realpath --relative-to "$dir" "$dst")
    ln -sv "$rel/$file" "$src"
done

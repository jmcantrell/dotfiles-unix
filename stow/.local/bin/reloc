#!/usr/bin/env bash

# Move files to a directory, then symlink them back to their original location.
# Usage: reloc DIRECTORY [PATH...]

set -euo pipefail

dst=${1:?missing destination directory}
shift

if (($# == 0)); then
    echo "${0##*/}: missing files to relocate" >&2
    exit 1
fi

mkdir -p "$dst"
mv -v -t "$dst" "$@"

for src in "$@"; do
    dir=$(dirname "$src")
    file=$(basename "$src")
    rel=$(realpath --relative-to "$dir" "$dst")
    ln -sv "$rel/$file" "$src"
done

#!/usr/bin/env bash

# Move a bunch of files to a directory,
# then symlink them back to their original location.
# Usage: reloc directory [path...]

if (($# < 2)); then
    echo "ERROR: there must be at least one file and a directory" >&2
    exit 1
fi

dst=$1
shift

mkdir -p "$dst"
mv -v -t "$dst" "$@"

for src in "$@"; do
    dir=$(dirname "$src")
    file=$(basename "$src")
    rel=$(realpath --relative-to "$dir" "$dst")
    ln -sv "$rel/$file" "$src"
done

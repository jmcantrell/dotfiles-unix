#!/usr/bin/env python3

"""Rename files by substitution."""

import os, re
from argparse import ArgumentParser


def sub_format(fn, p, r):
    d, n = os.path.split(fn)
    n = p.sub(r, n)
    return os.path.join(d, n) if n else fn


def parse_args():
    p = ArgumentParser(description=__doc__)
    p.add_argument(
        'files',
        nargs='*', metavar='file',
        help='file to rename'
    )
    p.add_argument(
        '-s', '--search',
        default='', required=True,
        help='text to replace'
    )
    p.add_argument(
        '-r', '--replace',
        default='', required=True,
        help='replacement'
    )
    p.add_argument(
        '-n', '--noop',
        action='store_true',
        help='dry run'
    )
    return p.parse_args()


def main():
    args = parse_args()
    if args.search:
        pat = re.compile(args.search, re.IGNORECASE)
        for fn in args.files:
            if os.path.exists(fn):
                nf = sub_format(fn, pat, args.replace)
                if fn != nf:
                    print(nf)
                    if not args.noop:
                        os.rename(fn, nf)


if __name__ == '__main__':
    main()

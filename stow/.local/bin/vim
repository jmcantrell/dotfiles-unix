#!/usr/bin/env bash

# Since the kind of vi-like editor available is not always consistent, this
# tries to use the most modern one, falling back to more ubiquitous versions.

set -e

bins=(nvim vim vi)
prefixes=(/usr/local/bin /usr/bin /bin)

link=${XDG_CACHE_HOME:-$HOME/.cache}/vi

if [[ ! -x $link ]]; then
    for bin in "${bins[@]}"; do
        for prefix in "${prefixes[@]}"; do
            if [[ -x $prefix/$bin ]]; then
                ln -s "$prefix/$bin" "$link"
                break 2
            fi
        done
    done
fi

if [[ ! -x $link ]]; then
    echo "No version of vim is available" >&2
    exit 1
fi

bin=$(readlink "$link")

exec "$bin" "$@"

#!/usr/bin/env bash

# Since the kind of vi-like editor available is not always consistent, this
# tries to use the most modern one, falling back to more ubiquitous versions.

set -e

link=${XDG_CACHE_HOME:-$HOME/.cache}/vi

if [[ ! -x $link ]]; then
    for editor in nvim vim vi; do
        for prefix in /usr/local/bin /usr/bin /bin; do
            bin=$prefix/$editor
            if [[ -x $bin ]]; then
                ln -s "$bin" "$link"
                break 2
            fi
        done
    done
fi

if [[ ! -x $link ]]; then
    echo "No version of vim is available" >&2
    exit 1
fi

bin=$(readlink "$link")

exec "$bin" "$@"

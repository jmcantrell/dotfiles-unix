#!/usr/bin/env bash

# Generate a SASL client key for a weechat IRC server.

set -euo pipefail

name=${1:?missing server name}

weechat=${XDG_CONFIG_DIR:-$HOME/.config}/weechat
pem=$weechat/$name.pem

if [[ -e $pem ]]; then
    echo "Key $pem already exists" >&2
    exit 1
fi

mkdir -p "$weechat"

openssl ecparam -genkey -name prime256v1 -out "$pem"

weechat-pubkey "$name" | cbi

echo "Public key for $name copied to clipboard" >&2

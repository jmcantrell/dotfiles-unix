#!/usr/bin/env bash

# Output the SASL public key for a weechat IRC server.

set -e

name=${1:?missing server name}

weechat=${XDG_CONFIG_HOME:-$HOME/.config}/weechat
pem=$weechat/$name.pem

if [[ ! -e $pem ]]; then
    echo "Key $pem does not exist" >&2
    exit 1
fi

openssl ec -noout -text -conv_form compressed -in "$pem" |
    grep '^pub:' -A 3 | tail -n 3 | tr -d ' \n:' | xxd -r -p | base64

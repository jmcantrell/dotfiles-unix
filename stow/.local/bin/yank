#!/usr/bin/env bash

set -euo pipefail

me=${0##*/}
usage="Yank file paths in order to operate on them in bulk.

Usage: $me [-h] [-lac] PATH...

Options:
    -h    show this help message
    -l    list paths
    -a    append paths
    -c    clear paths

The default action is to set the paths.
"

paths=${XDG_CACHE_HOME:-$HOME/.cache}/yank/paths

usage() {
    echo "$usage" >&2
    exit 0
}

die() {
    echo "$me: $*" >&2
    exit 1
}

do_list() {
    [[ -f $paths ]] && cat "$paths"
}

do_set() {
    do_clear
    do_add "$@"
}

do_add() {
    mkdir -p "$(dirname "$paths")"
    realpath "$@" >>"$paths"
}

do_clear() {
    rm -f "$paths"
}

action="set"

while (($# > 0)); do
    [[ $1 == -* ]] || break

    pos=$1
    shift

    case "$pos" in
    -l) action="list" ;;
    -a) action="add" ;;
    -c) action="clear" ;;

    -h) usage ;;

    -*) die "invalid option '$pos'" ;;
    esac
done

do_"$action" "$@"

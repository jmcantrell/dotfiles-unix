#!/usr/bin/env bash

set -euo pipefail

me=${0##*/}
usage="Yank file paths in order to operate on them in bulk.

Usage: $me [-h] [-alc] PATH...

Options:
    -h    show this help message
    -a    append paths
    -l    list paths
    -c    clear paths

The default action is to set the paths.
"

paths=${XDG_CACHE_HOME:-$HOME/.cache}/yank/paths

usage() {
    echo "$usage" >&2
    exit 0
}

die() {
    echo "$me: $*" >&2
    exit 1
}

do_add() {
    mkdir -p "$(dirname "$paths")"
    realpath "$@" >>"$paths"
}

do_set() {
    do_clear
    do_add "$@"
}

do_list() {
    [[ -f $paths ]] && cat "$paths"
}

do_clear() {
    rm -f "$paths"
}

action="set"
unset OPTIND OPTARG
while getopts ":halc" option; do
    case $option in
    h) usage ;;
    a) action="add" ;;
    l) action="list" ;;
    c) action="clear" ;;
    *) die "invalid option '$option'" ;;
    esac
done && shift $((OPTIND - 1))

do_"$action" "$@"
